angular.module("makemybooking.contacts",["googleApi"]).config(["googleLoginProvider",function(e){e.configure({clientId:"390294162018-trdjjr9s1vhb2qdnn3gi7gm3kq8ucc97.apps.googleusercontent.com",scopes:["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/calendar","https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/contacts.readonly"]})}]).service("googleContacts",["googleApiBuilder","$rootScope",function(e){var t=this;e.afterClientLoaded(function(){var e=gapi.auth.getToken();e.alt="json",t.listContacts=function(){return $.ajax({url:"https://www.google.com/m8/feeds/contacts/default/full",dataType:"jsonp",data:e}).fail(function(e){console.log(e)})}})}]).controller("ContactsController",["$scope","googleLogin","googleCalendar","googlePlus","googleContacts",function(e,t,n,o,a){e.login=function(){t.login()},e.$on("googlePlus:loaded",function(){o.getCurrentUser().then(function(t){e.currentUser=t})}),e.currentUser=t.currentUser,e.loadEvents=function(){n.listEvents({calendarId:this.selectedCalendar.id}).then(function(t){e.calendarItems=t})},e.loadCalendars=function(){n.listCalendars().then(function(t){e.calendars=t})},e.loadContacts=function(){a.listContacts().then(function(t){e.contactItems=t})}}]),angular.module("makemybooking.config",[]).constant("config",{defaultApiEndpoint:"/api"}).constant("appName","makemybooking-client").constant("appVersion","0.0.1").constant("appDescription","MakeMyBooking.co"),angular.module("ngLocale",[],["$provide",function(e){function t(e){e+="";var t=e.indexOf(".");return-1==t?0:e.length-t-1}function n(e,n){var o=n;void 0===o&&(o=Math.min(t(e),3));var a=Math.pow(10,o),i=(e*a|0)%a;return{v:o,f:i}}var o={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};e.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],MONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],SHORTDAY:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],SHORTMONTH:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",medium:"MMM d, y h:mm:ss a",mediumDate:"MMM d, y",mediumTime:"h:mm:ss a","short":"M/d/yy h:mm a",shortDate:"M/d/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"¤-",negSuf:"",posPre:"¤",posSuf:""}]},id:"en",pluralCat:function(e,t){var a=0|e,i=n(e,t);return 1==a&&0==i.v?o.ONE:o.OTHER}})}]),angular.module("ngLocale",[],["$provide",function(e){function t(e){e+="";var t=e.indexOf(".");return-1==t?0:e.length-t-1}function n(e,n){var o=n;void 0===o&&(o=Math.min(t(e),3));var a=Math.pow(10,o),i=(e*a|0)%a;return{v:o,f:i}}var o={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};e.value("$locale",{DATETIME_FORMATS:{AMPMS:["a.m.","p.m."],DAY:["duminică","luni","marți","miercuri","joi","vineri","sâmbătă"],MONTH:["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"],SHORTDAY:["Dum","Lun","Mar","Mie","Joi","Vin","Sâm"],SHORTMONTH:["ian.","feb.","mar.","apr.","mai","iun.","iul.","aug.","sept.","oct.","nov.","dec."],fullDate:"EEEE, d MMMM y",longDate:"d MMMM y",medium:"d MMM y HH:mm:ss",mediumDate:"d MMM y",mediumTime:"HH:mm:ss","short":"dd.MM.y HH:mm",shortDate:"dd.MM.y",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"RON",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:" ¤",posPre:"",posSuf:" ¤"}]},id:"ro",pluralCat:function(e,t){var a=0|e,i=n(e,t);return 1==a&&0==i.v?o.ONE:0!=i.v||0==e||1!=e&&e%100>=1&&19>=e%100?o.FEW:o.OTHER}})}]),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("activities/activities.html",'<div class="row"><div class="col-md-6"><h2>{{ \'activity.CreateNew\' | translate }}</h2><form role="form" name="form"><div class="form-group"><label for="displayName">{{ \'activity.DisplayName\' | translate }}</label><input class="form-control" id="displayName" placeholder="{{ \'activity.DisplayName\' | translate }}" ng-model="newActivity.displayName"></div><div class="form-group"><label for="duration">{{ \'activity.Duration\' | translate }}</label><input class="form-control" id="duration" placeholder="{{ \'activity.Duration\' | translate }}" ng-model="newActivity.duration"></div><button type="submit" class="btn btn-default" ng-click="createActivity()" ng-disabled="form.$invalid">{{ \'common.Create\' | translate }}</button></form></div><div class="col-md-6"><h2>{{ \'activity.Activities\' | translate }}</h2><p ng-if="activities.length === 0">-- {{ \'common.None\' | translate }} --</p><ul class="list-group"><li class="list-group-item" ng-repeat="activity in activities"><div><div class="dropdown"><a href="" class="pull-right" ng-click="removeActivity(activity)" title="{{ \'common.Remove\' | translate }}"><span class="glyphicon glyphicon-remove"></span></a></div></div><h4 class="list-group-item-heading">{{activity.displayName}} <small>{{activity.duration}}</small></h4></li></ul></div></div>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("appointments/appointments.html",'<div class="row"><div class="col-md-6"><h2>{{ \'appointment.CreateNew\' | translate }}</h2><form role="form" name="form"><div class="form-group"><input class="form-control" id="title" placeholder="{{ \'appointment.DisplayName\' | translate }}" ng-model="newAppointment.title"></div><div class="form-group"><label for="resource">{{ \'appointment.Resource\' | translate }}</label><select class="form-control" id="resource" ng-model="newAppointment.resource" ng-options="resource as resource.displayName for resource in resources"><option value="">{{ \'appointment.PickResource\' | translate }}</option></select></div><div class="form-group"><label for="dateAndTime">{{ \'appointment.DateTime\' | translate }}</label><div class="dropdown"><a class="dropdown-toggle" id="dropdown2" role="button" data-toggle="dropdown" data-target="#"><div class="input-group"><p class="form-control-static">{{ newAppointment.dateAndTime | date:\'d MMM, y H:mm\' }}</p></div></a><ul class="dropdown-menu" role="menu" aria-labelledby="dLabel"><datetimepicker ng-model="newAppointment.dateAndTime" data-before-render="beforeRender($view, $dates, $leftDate, $upDate, $rightDate)" datetimepicker-config="{ dropdownSelector: \'#dropdown2\', startView: \'hour\', minuteStep: 15 }"></ul></div></div><div class="form-group"><label for="duration">{{ \'appointment.Duration\' | translate }}</label><select class="form-control" id="duration" ng-model="newAppointment.duration"><option value="15">15 {{ \'appointment.Minutes\' | translate }}</option><option value="30">30 {{ \'appointment.Minutes\' | translate }}</option><option value="60">60 {{ \'appointment.Minutes\' | translate }}</option><option value="90">90 {{ \'appointment.Minutes\' | translate }}</option></select></div><div class="form-group"><label for="client">{{ \'appointment.Client\' | translate }}</label><select class="form-control" id="client" ng-model="newAppointment.client" ng-options="client as client.displayName for client in clients"><option value="">{{ \'appointment.PickClient\' | translate }}</option></select></div><div class="form-group"><label for="remarks">{{ \'appointment.Remarks\' | translate }}</label><textarea id="remarks" class="form-control" rows="3" ng-model="newAppointment.remarks"> </textarea></div><button type="submit" class="btn btn-default" ng-click="createAppointment()" ng-disabled="form.$invalid">{{ \'common.Create\' | translate }}</button></form></div><div class="col-md-6"><h2>{{ \'appointment.Upcoming\' | translate }}</h2><p ng-if="upcomingAppointments.length === 0">-- {{ \'common.None\' | translate }} --</p><ul class="list-group"><li class="list-group-item" ng-repeat="appointment in upcomingAppointments"><div><div class="dropdown"><a href="" class="pull-right" ng-click="removeAppointment(appointment)" title="{{ \'common.Remove\' | translate }}"><span class="glyphicon glyphicon-remove"></span></a> <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#" title="{{ \'appointment.Reschedule\' | translate }}" id="appointment{{$index}}" href="" ng-click="setAppointmentForEdit(appointment)"><span class="glyphicon glyphicon-time"></span></a><ul class="dropdown-menu" role="menu"><datetimepicker data-ng-model="editAppointment.dateAndTime" data-datetimepicker-config="{ dropdownSelector: \'#appointment{{$index}}\', startView: \'hour\', minuteStep: 15 }" on-set-time="reschedule(newDate, oldDate)"></ul></div></div><h4 class="list-group-item-heading">{{appointment.title}} <small>{{appointment.dateAndTime | date:\'d MMM, y H:mm\'}}-{{appointment.endDateAndTime | date:\'H:mm\'}}, duration {{appointment.duration}} mins</small></h4><p class="list-group-item-text">{{appointment.remarks}}</p></li></ul><h2>{{ \'appointment.Past\' | translate }}</h2><p ng-if="pastAppointments.length === 0">-- {{ \'common.None\' | translate }} --</p><ul class="list-group"><li class="list-group-item" ng-repeat="appointment in pastAppointments"><div><a href="" class="pull-right" ng-click="removeAppointment(appointment)" title="{{ \'common.Remove\' | translate }}"><span class="glyphicon glyphicon-remove"></span></a></div><h4 class="list-group-item-heading">{{appointment.title}} <small>{{appointment.dateAndTime | date:\'d MMM, y H:mm\'}}-{{appointment.endDateAndTime | date:\'H:mm\'}}, duration {{appointment.duration}} mins</small></h4><p class="list-group-item-text">{{appointment.remarks}}</p></li></ul></div></div>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("appointments/appointmentsView.html",'<div class="row"><div class="col-md-6"><h2>{{ \'appointment.CreateNew\' | translate }}</h2><form role="form" name="form"><div class="form-group"><input class="form-control" id="title" placeholder="{{ \'appointment.DisplayName\' | translate }}" ng-model="newAppointment.title"></div><tabset justified="true"><tab ng-repeat="resource in resources" heading="{{resource.displayName}}" ng-click="updateResource(resource)"><table id="{{resource.id}}" data-toggle="table" data-height="300" data-classes="table table-ultracondensed" bootstraptable><thead><tr><th>Hour</th><th ng-repeat=" day in days.slice(0,fwdays) ">{{ [\'Sun\', \'Mon\', \'Tue\', \'Wed\', \'Thu\', \'Fri\', \'Sat\'][day] }}</th></tr></thead><tr id="tr_id{{$index}}" ng-repeat="time in times"><td>{{time}}</td><td id="cell_{{$index}}_{{time.replace(\':\',\'-\')}}_{{resource.id}}" ng-repeat=" day in days.slice(0,fwdays) " day="{{$index}}" time="{{time}}" resource="{{resource.id}}" is-busy>&nbsp;</td></tr></table></tab></tabset><button type="submit" class="btn btn-default" ng-click="createAppointment()" ng-disabled="form.$invalid">{{ \'common.Create\' | translate }}</button></form></div><div class="col-md-6"><div class="form-group"><label for="dateAndTime">{{ \'appointment.DateTime\' | translate }}</label><div class="dropdown"><a class="dropdown-toggle" id="dropdown2" role="button" data-toggle="dropdown" data-target="#"><div class="input-group"><p class="form-control-static">{{ newAppointment.dateAndTime | date:\'d MMM, y H:mm\' }}</p></div></a><ul class="dropdown-menu" role="menu" aria-labelledby="dLabel"><datetimepicker ng-model="newAppointment.dateAndTime" data-before-render="beforeRender($view, $dates, $leftDate, $upDate, $rightDate)" datetimepicker-config="{ dropdownSelector: \'#dropdown2\', startView: \'hour\', minuteStep: 15 }"></ul></div></div><div class="form-group"><label for="duration">{{ \'appointment.Duration\' | translate }}</label><select class="form-control" id="duration" ng-model="newAppointment.duration"><option value="15">15 {{ \'appointment.Minutes\' | translate }}</option><option value="30">30 {{ \'appointment.Minutes\' | translate }}</option><option value="45">45 {{ \'appointment.Minutes\' | translate }}</option><option value="60">60 {{ \'appointment.Minutes\' | translate }}</option><option value="75">75 {{ \'appointment.Minutes\' | translate }}</option><option value="90">90 {{ \'appointment.Minutes\' | translate }}</option></select></div><div class="form-group"><label for="client">{{ \'appointment.Client\' | translate }}</label><select class="form-control" id="client" ng-model="newAppointment.client" ng-options="client as client.displayName for client in clients"><option value="">{{ \'appointment.PickClient\' | translate }}</option></select></div><div class="form-group"><div class="checkbox" ng-repeat="activity in activities"><label><input type="checkbox" checklist-model="newAppointment.remarks" checklist-value="activity"> {{activity.displayName}} {{activity.duration}}</label></div></div></div></div>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("auth/login.html",'<div class="row"><div class="col-md-6"><h2>{{ \'home.Login\' | translate }}</h2><form role="form" name="form"><div class="form-group"><label for="username">{{ \'user.Email\' | translate }}:</label><input id="username" class="form-control" ng-model="user.username"></div><div class="form-group"><label for="password">{{ \'user.Password\' | translate }}:</label><input id="password" class="form-control" type="password" ng-model="user.password"></div><button type="submit" ng-click="loginLocal(user)" class="btn btn-default">{{ \'home.Login\' | translate }}</button><br><br><a href="" ng-click="loginGoogle()">Login with Google</a></form></div></div>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("clients/clients.html",'<div class="row"><div class="col-md-6"><h2>{{ \'client.CreateNew\' | translate }}</h2><form role="form" name="form"><div class="form-group"><label for="displayName">{{ \'client.DisplayName\' | translate }}</label><input class="form-control" id="displayName" placeholder="{{ \'client.DisplayName\' | translate }}" ng-model="newClient.displayName"></div><div class="form-group"><label for="phone">{{ \'client.Phone\' | translate }}</label><input class="form-control" id="phone" placeholder="{{ \'client.Phone\' | translate }}" ng-model="newClient.phone"></div><div class="form-group"><label for="email">{{ \'client.Email\' | translate }}</label><input class="form-control" id="email" placeholder="{{ \'client.Email\' | translate }}" ng-model="newClient.email"></div><button type="submit" class="btn btn-default" ng-click="createClient()" ng-disabled="form.$invalid">{{ \'common.Create\' | translate }}</button></form></div><div class="col-md-6"><h2>{{ \'client.Clients\' | translate }}</h2><p ng-if="clients.length === 0">-- {{ \'common.None\' | translate }} --</p><ul class="list-group"><li class="list-group-item" ng-repeat="client in clients"><div><div class="dropdown"><a href="" class="pull-right" ng-click="removeClient(client)" title="{{ \'common.Remove\' | translate }}"><span class="glyphicon glyphicon-remove"></span></a></div></div><h4 class="list-group-item-heading">{{client.displayName}} <small>{{client.phone}}</small></h4></li></ul></div></div>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("home/home.html","<p translate=\"{{ 'home.home' | translate }}\"></p><footer class=\"pull-right\">{{ 'home.appName' | translate }} version {{version}} - &copy; Bogdan-Ioan BRUDIU 2015</footer>")}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("public/public.html",'<p translate="{{ \'home.Public\' | translate }}"></p><p>&lt;iframe src="#/publicappointments/{{user.userId}}"/&gt;</p>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("publicappointments/publicappointments.html",'<div class="row"><div class="col-md-6"><h2>{{ \'appointment.CreateNew\' | translate }}</h2><form role="form" name="form"><div class="form-group"><input class="form-control" id="title" placeholder="{{ \'appointment.DisplayName\' | translate }}" ng-model="newAppointment.title"></div><tabset justified="true"><tab ng-repeat="resource in resources" heading="{{resource.displayName}}" ng-click="updateResource(resource)"><table id="{{resource.id}}" data-toggle="table" data-height="300" data-classes="table table-ultracondensed" bootstraptable><thead><tr><th>Hour</th><th ng-repeat=" day in days.slice(0,fwdays) ">{{ [\'Sun\', \'Mon\', \'Tue\', \'Wed\', \'Thu\', \'Fri\', \'Sat\'][day] }}</th></tr></thead><tr id="tr_id{{$index}}" ng-repeat="time in times"><td>{{time}}</td><td id="cell_{{$index}}_{{time.replace(\':\',\'-\')}}_{{resource.id}}" ng-repeat=" day in days.slice(0,fwdays) " day="{{$index}}" time="{{time}}" resource="{{resource.id}}" is-busy>&nbsp;</td></tr></table></tab></tabset><button type="submit" class="btn btn-default" ng-click="createAppointment()" ng-disabled="form.$invalid">{{ \'common.Create\' | translate }}</button></form></div><div class="col-md-6"><div class="form-group"><label for="dateAndTime">{{ \'appointment.DateTime\' | translate }}</label><div class="dropdown"><a class="dropdown-toggle" id="dropdown2" role="button" data-toggle="dropdown" data-target="#"><div class="input-group"><p class="form-control-static">{{ newAppointment.dateAndTime | date:\'d MMM, y H:mm\' }}</p></div></a><ul class="dropdown-menu" role="menu" aria-labelledby="dLabel"><datetimepicker ng-model="newAppointment.dateAndTime" data-before-render="beforeRender($view, $dates, $leftDate, $upDate, $rightDate)" datetimepicker-config="{ dropdownSelector: \'#dropdown2\', startView: \'hour\', minuteStep: 15 }"></ul></div></div><div class="form-group"><div class="checkbox" ng-repeat="activity in activities"><label><input type="checkbox" checklist-model="newAppointment.remarks" checklist-value="activity"> {{activity.displayName}} {{activity.duration}}</label></div></div></div></div>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("resources/resources.html",'<div class="row"><div class="col-md-6"><h2>{{ \'resource.CreateNew\' | translate }}</h2><form role="form" name="form"><div class="form-group"><label for="displayName">{{ \'resource.DisplayName\' | translate }}</label><input class="form-control" id="displayName" placeholder="{{ \'resource.DisplayName\' | translate }}" ng-model="newResource.displayName"></div><button type="submit" class="btn btn-default" ng-click="createResource()" ng-disabled="form.$invalid">{{ \'common.Create\' | translate }}</button></form></div><div class="col-md-6"><h2>{{ \'resource.Resources\' | translate }}</h2><p ng-if="resources.length === 0">-- {{ \'common.None\' | translate }} --</p><ul class="list-group"><li class="list-group-item" ng-repeat="resource in resources"><div><div class="dropdown"><a href="" class="pull-right" ng-click="removeResource(resource)" title="{{ \'common.Remove\' | translate }}"><span class="glyphicon glyphicon-remove"></span></a></div></div><h4 class="list-group-item-heading">{{resource.displayName}}</h4></li></ul></div></div>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("users/users.html",'<div class="row"><div class="col-md-6"><h2>{{ \'user.CreateNew\' | translate }}</h2><form role="form" name="form"><div class="form-group"><label for="displayName">{{ \'user.DisplayName\' | translate }}</label><input class="form-control" id="displayName" placeholder="{{ \'user.DisplayName\' | translate }}" ng-model="newUser.displayName"></div><div class="form-group"><label for="email">{{ \'user.Email\' | translate }}</label><input class="form-control" id="email" placeholder="{{ \'user.Email\' | translate }}" ng-model="newUser.email"></div><div class="form-group"><label for="provider">{{ \'user.Provider\' | translate }}</label><input class="form-control" id="provider" placeholder="{{ \'user.Provider\' | translate }}" ng-model="newUser.provider"></div><div class="form-group"><label for="password">{{ \'user.Password\' | translate }}</label><input type="password" class="form-control" id="password" placeholder="{{ \'user.Password\' | translate }}" ng-model="newUser.password"></div><button type="submit" class="btn btn-default" ng-click="createUser()" ng-disabled="form.$invalid">{{ \'common.Create\' | translate }}</button></form></div><div class="col-md-6"><h2>{{ \'user.Users\' | translate }}</h2><p ng-if="users.length === 0">-- {{ \'common.None\' | translate }} --</p><ul class="list-group"><li class="list-group-item" ng-repeat="user in users"><div><div class="dropdown"><a href="" class="pull-right" ng-click="removeUser(user)" title="{{ \'common.Remove\' | translate }}"><span class="glyphicon glyphicon-remove"></span></a></div></div><h4 class="list-group-item-heading">{{user.displayName}} <small>{{user.provider}}</small></h4><p class="list-group-item-text">{{user.email}}</p><p class="list-group-item-text">{{user.roles.join(\', \')}}</p></li></ul></div></div>')}])}(),function(e){try{e=angular.module("makemybooking-client-templates")}catch(t){e=angular.module("makemybooking-client-templates",[])}e.run(["$templateCache",function(e){e.put("shared/flash.html",'<section ng-controller="FlashCtrl" class="flashcontainer"><div ng-repeat="flashMessage in flashMessages" ng-class="getMessageClass(flashMessage.level)"><button type="button" class="close" data-dismiss="alert" ng-click="dismiss(flashMessage)">&times;</button> {{flashMessage.message}}<ul ng-if="flashMessage.details.errors"><li ng-repeat="error in flashMessage.details.errors">{{error.message}}</li></ul></div></section>')}])}(),angular.module("makemybooking.directives",[]),angular.module("makemybooking.flash",[]).factory("flash",["$rootScope","$timeout",function(e,t){function n(n,o,a){o=o||"info";var r={message:n,level:o,details:a};l.push(r),t(function(){i(r)},5e3),e.$broadcast("event:flash.add",r)}function o(e){e.message?n(e.message,"error",e):n(e,"error")}function a(){return l}function i(t){var n=l.indexOf(t);l.splice(n,1),e.$broadcast("event:flash.remove",t)}function r(){l=[],e.$broadcast("event:flash.clear",!0)}var l=[];return{add:n,addError:o,all:a,remove:i,clear:r}}]).controller("FlashCtrl",["$scope","flash",function(e,t){e.flashMessages=[],e.getMessageClass=function(e){return"error"===e&&(e="danger"),"alert alert-"+e},e.dismiss=function(e){t.remove(e)},e.$on("event:flash.add",function(){e.flashMessages=t.all()}),e.$on("event:flash.remove",function(){e.flashMessages=t.all()}),e.$on("event:flash.clear",function(){e.flashMessages=[],e.$apply()})}]).directive("apHideFlash",["flash",function(e){return{restrict:"A",link:function(t,n){n.bind("click",function(t){var n=angular.element(t.target);n.parents().hasClass("flashcontainer")||e.clear()})}}}]),angular.module("makemybooking.home",["makemybooking.config","ngRoute"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"home/home.html",controller:"HomeCtrl",title:"Home"})}]).controller("HomeCtrl",["$scope","appVersion",function(e,t){e.version=t}]),angular.module("makemybooking.api",["angular-hal","makemybooking.config"]).factory("makemybookingapi",["halClient","config",function(e,t){var n=e.$get(t.defaultApiEndpoint);return{apiRoot:n}}]),angular.module("makemybooking.activities",["ngRoute","makemybooking.api"]).config(["$routeProvider",function(e){e.when("/activities",{templateUrl:"activities/activities.html",controller:"ActivitiesCtrl",title:"Activities"})}]).controller("ActivitiesCtrl",["$scope","$window","_","$translate","makemybookingapi","flash","moment",function(e,t,n,o,a,i){function r(){return a.apiRoot.then(function(t){return t.$get("activities").then(function(t){return t.$get("activities").then(function(t){e.activities=t})},function(e){i.addError(e.data)})})}function l(){e.newActivity={displayName:""}}e.createActivity=function(){return a.apiRoot.then(function(t){return t.$post("activities",null,e.newActivity).then(function(){i.add(o.instant("activity.Created"),"info"),l()},function(e){i.addError(e.data)})}).then(r)},e.removeActivity=function(e){return t.confirm(o.instant("common.AreYouSure"))?e.$del("self").then(function(e){i.add(e.message)},function(e){i.addError(e.data)}).then(r):void 0},l(),r()}]),angular.module("makemybooking.appointments",["ngRoute","makemybooking.api"]).config(["$routeProvider",function(e){e.when("/appointments",{templateUrl:"appointments/appointments.html",controller:"AppointmentsCtrl",title:"Appointments"})}]).controller("AppointmentsCtrl",["$scope","$window","_","$translate","makemybookingapi","flash","moment",function(e,t,n,o,a,i,r){function l(){a.apiRoot.then(function(t){return t.$get("appointments").then(function(t){return t.$get("appointments").then(function(t){e.upcomingAppointments=n.filter(t,function(e){return r(e.dateAndTime)>r()}),e.pastAppointments=n.filter(t,function(e){return r(e.dateAndTime)<=r()})})},function(e){i.addError(e.data)})}),a.apiRoot.then(function(t){return t.$get("resources").then(function(t){return t.$get("resources").then(function(t){e.resources=t})},function(e){i.addError(e.data)})}),a.apiRoot.then(function(t){return t.$get("clients").then(function(t){return t.$get("clients").then(function(t){e.clients=t})},function(e){i.addError(e.data)})})}function s(){e.newAppointment={title:"",dateAndTime:r().startOf("day").add(1,"days").add(9,"hours").toDate(),duration:30,remarks:""},e.editAppointment=null}e.getEndTime=function(e){return r(e.dateAndTime).add(e.duration,"minutes").format("H:mm")},e.createAppointment=function(){return a.apiRoot.then(function(t){return e.newAppointment.endDateAndTime=r(e.newAppointment.dateAndTime).add(e.newAppointment.duration,"minutes"),t.$post("appointments",null,e.newAppointment).then(function(){i.add(o.instant("appointment.Created"),"info"),s()},function(e){i.addError(e.data)})}).then(l)},e.removeAppointment=function(e){return t.confirm(o.instant("common.AreYouSure"))?e.$del("self").then(function(e){i.add(e.message)},function(e){i.addError(e.data)}).then(l):void 0},e.setAppointmentForEdit=function(t){e.editAppointment=angular.copy(t)},e.reschedule=function(t){if(e.editAppointment){e.editAppointment.dateAndTime=t,e.editAppointment.endDateAndTime=r(e.editAppointment.dateAndTime).add(e.editAppointment.duration,"minutes").toDate();var o=n(e.upcomingAppointments).find({id:e.editAppointment.id});return o.$patch("self",null,{dateAndTime:e.editAppointment.dateAndTime,endDateAndTime:e.editAppointment.endDateAndTime}).then(function(){i.add("Appointment is rescheduled")},function(e){i.addError(e.data)}).then(l)}},e.beforeRender=function(e,t){a.apiRoot.then(function(e){return e.$get("appointments").then(function(e){return e.$get("appointments").then(function(e){e.forEach(function(){t.forEach(function(n){e.filter(function(e){return n.dateValue+60*(new Date).getTimezoneOffset()*1e3>=Date.parse(e.dateAndTime)&&n.dateValue+60*(new Date).getTimezoneOffset()*1e3<Date.parse(e.endDateAndTime)?e:void 0}).length>0&&(t[t.indexOf(n)].selectable=!1)})})})})})},s(),l()}]),angular.module("makemybooking.appointmentsView",["ngRoute","makemybooking.api"]).config(["$routeProvider",function(e){e.when("/appointmentsView",{templateUrl:"appointments/appointmentsView.html",controller:"AppointmentsViewCtrl",title:"AppointmentsView"})}]).controller("AppointmentsViewCtrl",["$scope","$window","_","$translate","makemybookingapi","flash","moment",function(e,t,n,o,a,i,r){function l(){return a.apiRoot.then(function(t){return t.$get("resources").then(function(t){return t.$get("resources").then(function(t){angular.equals(e.resources,t)||(e.resources=t)})},function(e){i.addError(e.data)})}),a.apiRoot.then(function(t){return t.$get("clients").then(function(t){return t.$get("clients").then(function(t){angular.equals(e.clients,t)||(e.clients=t)})},function(e){i.addError(e.data)})}),a.apiRoot.then(function(t){return t.$get("activities").then(function(t){return t.$get("activities").then(function(t){angular.equals(e.activities,t)||(e.activities=t)})},function(e){i.addError(e.data)})}),e.appointmentsPromise=a.apiRoot.then(function(t){return t.$get("appointments").then(function(t){return t.$get("appointments").then(function(t){return e.appointments=t,e.refreshBusy(t),t})},function(e){i.addError(e.data)})}),e.appointmentsPromise}function s(){e.newAppointment={title:"",dateAndTime:r().startOf("day").add(1,"days").add(9,"hours").toDate(),duration:30,remarks:[]},e.editAppointment=null}e.fwdays=3,e.whours=10,e.granularity=10,e.celsMerge=3;var u=new Date;e.days=[u.getDay()%7,(u.getDay()+1)%7,(u.getDay()+2)%7,(u.getDay()+3)%7,(u.getDay()+4)%7,(u.getDay()+5)%7,(u.getDay()+6)%7],e.times=[];for(var c=0;c<60*e.whours;c+=e.granularity)e.times.push((c-c%60)/60+8+":"+(c%60==0?"00":c%60));e.updateDuration=function(){total=0,e.newAppointment.remarks.forEach(function(e){total+=parseInt(e.duration)}),e.newAppointment.duration=total},e.refreshBusy=function(t){$("td").removeClass("isbusy"),t.forEach(function(t){if(t.resource)for(appDate=new Date(t.dateAndTime),appDate.setHours(0,0,0,0),u=new Date,u.setHours(0,0,0,0),day=(appDate-u)/864e5,c=0;c<t.duration/e.granularity;c++)min=new Date(t.dateAndTime).getMinutes()+c*e.granularity,hour=new Date(t.dateAndTime).getHours()+Math.floor(min/60),time=hour+"-"+(min%60==0?"00":min%60),$('td[id^="cell_'+day+"_"+time+"_"+(t.resource?t.resource.id:"")+'"]').addClass("isbusy")})},e.refreshCandidate=function(){if(null!=e.newAppointment&&null!=e.newAppointment.resource)for($("td").removeClass("iscandidate"),appDate=new Date(e.newAppointment.dateAndTime),appDate.setHours(0,0,0,0),u=new Date,u.setHours(0,0,0,0),day=(appDate-u)/864e5,c=0;c<e.newAppointment.duration/e.granularity;c++)min=new Date(e.newAppointment.dateAndTime).getMinutes()+c*e.granularity,hour=new Date(e.newAppointment.dateAndTime).getHours()+Math.floor(min/60),time=hour+"-"+(min%60==0?"00":min%60),$('td[id^="cell_'+day+"_"+time+"_"+e.newAppointment.resource.id+'"]').addClass("iscandidate")},e.$watch(function(e){return e.newAppointment.dateAndTime},function(){e.refreshCandidate()}),e.$watch(function(e){return e.newAppointment.duration},function(){e.refreshCandidate()}),e.$watchCollection(function(e){return e.newAppointment.remarks},function(){e.updateDuration()}),e.getEndTime=function(e){return r(e.dateAndTime).add(e.duration,"minutes").format("H:mm")},e.setDate=function(t,n,o){e.newAppointment.dateAndTime=new Date,e.newAppointment.dateAndTime.setDate(e.newAppointment.dateAndTime.getDate()+parseInt(t)),e.newAppointment.dateAndTime.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]),0,0),e.resources.forEach(function(t){return t.id===o?(e.newAppointment.resource=t,void 0):void 0})},e.createAppointment=function(){return a.apiRoot.then(function(t){return e.newAppointment.endDateAndTime=r(e.newAppointment.dateAndTime).add(e.newAppointment.duration,"minutes"),t.$post("appointments",null,e.newAppointment).then(function(){i.add(o.instant("appointment.Created"),"info"),s()
},function(e){i.addError(e.data)})}).then(l)},e.updateResource=function(t){e.newAppointment.resource=t},e.removeAppointment=function(e){return t.confirm(o.instant("common.AreYouSure"))?e.$del("self").then(function(e){i.add(e.message)},function(e){i.addError(e.data)}).then(l):void 0},e.setAppointmentForEdit=function(t){e.editAppointment=angular.copy(t)},e.reschedule=function(t){if(e.editAppointment){e.editAppointment.dateAndTime=t,e.editAppointment.endDateAndTime=r(e.editAppointment.dateAndTime).add(e.editAppointment.duration,"minutes").toDate();var o=n(e.upcomingAppointments).find({id:e.editAppointment.id});return o.$patch("self",null,{dateAndTime:e.editAppointment.dateAndTime,endDateAndTime:e.editAppointment.endDateAndTime}).then(function(){i.add("Appointment is rescheduled")},function(e){i.addError(e.data)}).then(l)}},e.beforeRender=function(t,n){e.appointmentsPromise.then(function(e){e.forEach(function(){n.forEach(function(t){e.filter(function(e){return t.dateValue+60*(new Date).getTimezoneOffset()*1e3>=Date.parse(e.dateAndTime)&&t.dateValue+60*(new Date).getTimezoneOffset()*1e3<Date.parse(e.endDateAndTime)?e:void 0}).length>0&&(n[n.indexOf(t)].selectable=!1)})})})},s(),e.appointmentsPromise=l()}]).directive("bootstraptable",["$timeout",function(e){return{link:function(t,n){var o=function(){t.appointmentsPromise.then(function(){angular.element(n).hasClass("bootstrapTable")||(angular.element(n).bootstrapTable(),angular.element(n).addClass("bootstrapTable"),t.times.forEach(function(e,o){o%t.celsMerge==1&&(angular.element(n).bootstrapTable("mergeCells",{index:o-1,field:0,rowspan:t.celsMerge}),o%(60/t.granularity)==1?angular.element(n).find("#tr_id"+(o-1)).addClass("highlighthour"):angular.element(n).find("#tr_id"+(o-1)).addClass("highlight"))}),angular.element(n).find("td:not(:first-child):not(.isbusy)").click(function(){cellid=this.id,cellid=cellid.substr(5),day=cellid.split("_")[0],time=cellid.split("_")[1].replace("-",":"),resource=cellid.split("_")[2],t.setDate(day,time,resource)}))})};e(o,0)}}}]),angular.module("makemybooking.usersession",["makemybooking.api","makemybooking.flash","makemybooking.config"]).factory("usersession",["$rootScope","$window","config","flash","makemybookingapi","_",function(e,t,n,o,a,i){function r(){return angular.copy(u,this)}function l(n){return t.localStorage.setItem("access_token",n),a.apiRoot.then(function(t){return t.$get("me").then(function(t){c.isAuthenticated=!0,c.userId=t.userId,c.displayName=t.displayName,c.roles=t.roles,c.allowsPublic=t.allowsPublic,e.$broadcast("event:loggedin",c)},function(e){o.add(e.message,"error")})})}function s(){t.localStorage.removeItem("access_token"),c=new r,e.$broadcast("event:loggedout",c)}var u={userId:"",displayName:"",isAuthenticated:!1,roles:[],isInRole:function(e){return this.isAuthenticated&&i(this.roles).contains(e)},isAdmin:function(){return this.isInRole("admin")},isCustomer:function(){return this.isInRole("customer")},allowsPublic:!1},c=new r,d="";return{current:c,login:l,logout:s,returnTo:d}}]).run(["$window","$rootScope","$log","makemybookingapi","usersession",function(e,t,n,o,a){null!==e.localStorage.getItem("access_token")&&o.apiRoot.then(function(e){e.$get("me").then(function(e){a.current.isAuthenticated=!0,a.current.userId=e.userId,a.current.displayName=e.displayName,a.current.roles=e.roles,a.current.allowsPublic=e.allowsPublic,t.$broadcast("event:loggedin",a.current)},function(e){n.info("Unable to login automatically: "+e.message)})})}]),angular.module("makemybooking.clients",["ngRoute","makemybooking.api"]).config(["$routeProvider",function(e){e.when("/clients",{templateUrl:"clients/clients.html",controller:"ClientsCtrl",title:"Clients"})}]).controller("ClientsCtrl",["$scope","$window","_","$translate","makemybookingapi","flash","moment",function(e,t,n,o,a,i){function r(){return a.apiRoot.then(function(t){return t.$get("clients").then(function(t){return t.$get("clients").then(function(t){e.clients=t})},function(e){i.addError(e.data)})})}function l(){e.newClient={displayName:""}}e.createClient=function(){return a.apiRoot.then(function(t){return t.$post("clients",null,e.newClient).then(function(){i.add(o.instant("client.Created"),"info"),l()},function(e){i.addError(e.data)})}).then(r)},e.removeClient=function(e){return t.confirm(o.instant("common.AreYouSure"))?e.$del("self").then(function(e){i.add(e.message)},function(e){i.addError(e.data)}).then(r):void 0},l(),r()}]),angular.module("makemybooking.public",["makemybooking.config","makemybooking.api","makemybooking.flash","ngRoute"]).config(["$routeProvider",function(e){e.when("/public",{templateUrl:"public/public.html",controller:"PublicCtrl",title:"Public"})}]).controller("PublicCtrl",["$scope","flash","makemybookingapi",function(e,t,n){n.apiRoot.then(function(n){return n.$get("me").then(function(t){e.user=t},function(e){t.addError(e.data)})})}]),angular.module("makemybooking.publicappointments",["ngRoute","makemybooking.api"]).config(["$routeProvider",function(e){e.when("/publicappointments/:userId",{templateUrl:"publicappointments/publicappointments.html",controller:"PublicAppointmentsCtrl",title:"PublicAppointments"})}]).controller("PublicAppointmentsCtrl",["$scope","$window","_","$translate","makemybookingapi","flash","moment",function(e,t,n,o,a,i,r){function l(){return a.apiRoot.then(function(t){return t.$get("publicresources",{userId:e.$parent.currentRoute.params.userId}).then(function(t){return t.$get("resources").then(function(t){angular.equals(e.resources,t)||(e.resources=t)})},function(e){i.addError(e.data)})}),a.apiRoot.then(function(t){return t.$get("publicactivities",{userId:e.$parent.currentRoute.params.userId}).then(function(t){return t.$get("activities").then(function(t){angular.equals(e.activities,t)||(e.activities=t)})},function(e){i.addError(e.data)})}),e.appointmentsPromise=a.apiRoot.then(function(t){return t.$get("publicappointments",{userId:e.$parent.currentRoute.params.userId}).then(function(t){return t.$get("appointments").then(function(t){return e.appointments=t,e.refreshBusy(t),t})},function(e){i.addError(e.data)})}),e.appointmentsPromise}function s(){e.newAppointment={title:"",dateAndTime:r().startOf("day").add(1,"days").add(9,"hours").toDate(),duration:30,remarks:[]},e.editAppointment=null}e.fwdays=3,e.whours=10,e.granularity=10,e.celsMerge=3;var u=new Date;e.days=[u.getDay()%7,(u.getDay()+1)%7,(u.getDay()+2)%7,(u.getDay()+3)%7,(u.getDay()+4)%7,(u.getDay()+5)%7,(u.getDay()+6)%7],e.times=[];for(var c=0;c<60*e.whours;c+=e.granularity)e.times.push((c-c%60)/60+8+":"+(c%60==0?"00":c%60));e.updateDuration=function(){total=0,e.newAppointment.remarks.forEach(function(e){total+=parseInt(e.duration)}),e.newAppointment.duration=total},e.refreshBusy=function(t){$("td").removeClass("isbusy"),t.forEach(function(t){if(t.resource)for(appDate=new Date(t.dateAndTime),appDate.setHours(0,0,0,0),u=new Date,u.setHours(0,0,0,0),day=(appDate-u)/864e5,c=0;c<t.duration/e.granularity;c++)min=new Date(t.dateAndTime).getMinutes()+c*e.granularity,hour=new Date(t.dateAndTime).getHours()+Math.floor(min/60),time=hour+"-"+(min%60==0?"00":min%60),$('td[id^="cell_'+day+"_"+time+"_"+(t.resource?t.resource.id:"")+'"]').addClass("isbusy")})},e.refreshCandidate=function(){if(null!=e.newAppointment&&null!=e.newAppointment.resource)for($("td").removeClass("iscandidate"),appDate=new Date(e.newAppointment.dateAndTime),appDate.setHours(0,0,0,0),u=new Date,u.setHours(0,0,0,0),day=(appDate-u)/864e5,c=0;c<e.newAppointment.duration/e.granularity;c++)min=new Date(e.newAppointment.dateAndTime).getMinutes()+c*e.granularity,hour=new Date(e.newAppointment.dateAndTime).getHours()+Math.floor(min/60),time=hour+"-"+(min%60==0?"00":min%60),$('td[id^="cell_'+day+"_"+time+"_"+e.newAppointment.resource.id+'"]').addClass("iscandidate")},e.$watch(function(e){return e.newAppointment.dateAndTime},function(){e.refreshCandidate()}),e.$watch(function(e){return e.newAppointment.duration},function(){e.refreshCandidate()}),e.$watchCollection(function(e){return e.newAppointment.remarks},function(){e.updateDuration()}),e.getEndTime=function(e){return r(e.dateAndTime).add(e.duration,"minutes").format("H:mm")},e.setDate=function(t,n,o){e.newAppointment.dateAndTime=new Date,e.newAppointment.dateAndTime.setDate(e.newAppointment.dateAndTime.getDate()+parseInt(t)),e.newAppointment.dateAndTime.setHours(parseInt(n.split(":")[0]),parseInt(n.split(":")[1]),0,0),e.resources.forEach(function(t){return t.id===o?(e.newAppointment.resource=t,void 0):void 0})},e.createAppointment=function(){return a.apiRoot.then(function(t){return e.newAppointment.endDateAndTime=r(e.newAppointment.dateAndTime).add(e.newAppointment.duration,"minutes"),t.$post("appointments",null,e.newAppointment).then(function(){i.add(o.instant("appointment.Created"),"info"),s()},function(e){i.addError(e.data)})}).then(l)},e.updateResource=function(t){e.newAppointment.resource=t},e.removeAppointment=function(e){return t.confirm(o.instant("common.AreYouSure"))?e.$del("self").then(function(e){i.add(e.message)},function(e){i.addError(e.data)}).then(l):void 0},e.setAppointmentForEdit=function(t){e.editAppointment=angular.copy(t)},e.reschedule=function(t){if(e.editAppointment){e.editAppointment.dateAndTime=t,e.editAppointment.endDateAndTime=r(e.editAppointment.dateAndTime).add(e.editAppointment.duration,"minutes").toDate();var o=n(e.upcomingAppointments).find({id:e.editAppointment.id});return o.$patch("self",null,{dateAndTime:e.editAppointment.dateAndTime,endDateAndTime:e.editAppointment.endDateAndTime}).then(function(){i.add("Appointment is rescheduled")},function(e){i.addError(e.data)}).then(l)}},e.beforeRender=function(t,n){e.appointmentsPromise.then(function(e){e.forEach(function(){n.forEach(function(t){e.filter(function(e){return t.dateValue+60*(new Date).getTimezoneOffset()*1e3>=Date.parse(e.dateAndTime)&&t.dateValue+60*(new Date).getTimezoneOffset()*1e3<Date.parse(e.endDateAndTime)?e:void 0}).length>0&&(n[n.indexOf(t)].selectable=!1)})})})},s(),e.appointmentsPromise=l()}]).directive("bootstraptable",["$timeout",function(e){return{link:function(t,n){var o=function(){t.appointmentsPromise.then(function(){angular.element(n).hasClass("bootstrapTable")||(angular.element(n).bootstrapTable(),angular.element(n).addClass("bootstrapTable"),t.times.forEach(function(e,o){o%t.celsMerge==1&&(angular.element(n).bootstrapTable("mergeCells",{index:o-1,field:0,rowspan:t.celsMerge}),o%(60/t.granularity)==1?angular.element(n).find("#tr_id"+(o-1)).addClass("highlighthour"):angular.element(n).find("#tr_id"+(o-1)).addClass("highlight"))}),angular.element(n).find("td:not(:first-child):not(.isbusy)").click(function(){cellid=this.id,cellid=cellid.substr(5),day=cellid.split("_")[0],time=cellid.split("_")[1].replace("-",":"),resource=cellid.split("_")[2],t.setDate(day,time,resource)}))})};e(o,0)}}}]),angular.module("makemybooking.resources",["ngRoute","makemybooking.api"]).config(["$routeProvider",function(e){e.when("/resources",{templateUrl:"resources/resources.html",controller:"ResourcesCtrl",title:"Resources"})}]).controller("ResourcesCtrl",["$scope","$window","_","$translate","makemybookingapi","flash",function(e,t,n,o,a,i){function r(){return a.apiRoot.then(function(t){return t.$get("resources").then(function(t){return t.$get("resources").then(function(t){e.resources=t})},function(e){i.addError(e.data)})})}function l(){e.newResource={displayName:""}}e.createResource=function(){return a.apiRoot.then(function(t){return t.$post("resources",null,e.newResource).then(function(){i.add(o.instant("resource.Created"),"info"),l()},function(e){i.addError(e.data)})}).then(r)},e.removeResource=function(e){return t.confirm(o.instant("common.AreYouSure"))?e.$del("self").then(function(e){i.add(e.message)},function(e){i.addError(e.data)}).then(r):void 0},l(),r()}]),angular.module("makemybooking.users",["ngRoute","makemybooking.api"]).config(["$routeProvider",function(e){e.when("/users",{templateUrl:"users/users.html",controller:"UsersCtrl",title:"Users"})}]).controller("UsersCtrl",["$scope","$window","_","$translate","makemybookingapi","flash",function(e,t,n,o,a,i){function r(){return a.apiRoot.then(function(t){return t.$get("users").then(function(t){return t.$get("users").then(function(t){e.users=t})},function(e){i.addError(e.data)})})}function l(){e.newUser={displayName:"",email:"",password:"",provider:"local"}}e.createUser=function(){return a.apiRoot.then(function(t){return t.$post("users",null,e.newUser).then(function(){i.add(o.instant("user.Created"),"info"),l()},function(e){i.addError(e.data)})}).then(r)},e.removeUser=function(e){return t.confirm(o.instant("common.AreYouSure"))?e.$del("self").then(function(e){i.add(e.message)},function(e){i.addError(e.data)}).then(r):void 0},l(),r()}]),angular.module("makemybooking.authinterceptor",["makemybooking.usersession"]).factory("authInterceptor",["$rootScope","$q","$window","$location","$log","$injector",function(e,t,n,o,a,i){return{request:function(e){return e.headers=e.headers||{},n.localStorage.getItem("access_token")&&(e.headers.Authorization="Bearer "+n.localStorage.getItem("access_token")),e},response:function(e){return 401===e.status&&a.warn("Response 401"),e||t.when(e)},responseError:function(e){if(401===e.status){var n=i.get("usersession");a.info("Response Error 401",e),n.logout();var r=o.path();o.path("/login").search("returnTo",r)}return t.reject(e)}}}]).config(["$httpProvider",function(e){e.interceptors.push("authInterceptor")}]),angular.module("makemybooking.login",["makemybooking.config","makemybooking.usersession","makemybooking.api","ngRoute"]).config(["$routeProvider",function(e){e.when("/login",{templateUrl:"auth/login.html",controller:"LoginCtrl",title:"Login"})}]).run(["$window","$rootScope","$location","config","usersession",function(e,t,n,o,a){t.authLogin=function(e){a.login(e).then(function(){t.loginPopup&&(t.loginPopup.close(),delete t.loginPopup),a.returnTo?n.url(a.returnTo):n.url("/")})},e.addEventListener("message",function(e){e.origin===o.defaultApiEndpoint&&t.authLogin(e.data)},!1)}]).controller("LoginCtrl",["$scope","$rootScope","$window","$location","config","usersession","makemybookingapi",function(e,t,n,o,a,i,r){function l(e){return t.loginPopup=s(e,"authenticate",640,500),!1}function s(e,t,o,a){var i=screen.width/2-o/2,r=screen.height/2-a/2;return n.open(e,t,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+o+", height="+a+", top="+r+", left="+i)}i.returnTo=o.search().returnTo,e.loginFacebook=function(){return l(a.defaultApiEndpoint+"/auth/facebook")},e.loginGoogle=function(){return l(a.defaultApiEndpoint+"/auth/google")},e.loginLocal=function(e){r.apiRoot.then(function(n){return n.$get("localauth",{username:e.username,password:e.password}).then(function(e){t.authLogin(e.token)})})}}]),angular.module("makemybooking",["ngRoute","pascalprecht.translate","tmh.dynamicLocale","ui.bootstrap.datetimepicker","ui.bootstrap","checklist-model","makemybooking.directives","makemybooking.flash","makemybooking.usersession","makemybooking.authinterceptor","makemybooking.home","makemybooking.login","makemybooking.public","makemybooking.publicappointments","makemybooking.appointmentsView","makemybooking.resources","makemybooking.clients","makemybooking.users","makemybooking.activities","makemybooking.contacts","makemybooking-client-templates"]).constant("_",window._).constant("moment",window.moment).config(["$httpProvider","$translateProvider","tmhDynamicLocaleProvider",function(e,t,n){e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"],t.preferredLanguage("en"),t.useStaticFilesLoader({prefix:"/i18n/",suffix:".json"}),n.defaultLocale("en"),n.localeLocationPattern("/i18n/angular-locale_{{locale}}.js")}]).controller("AppCtrl",["$scope","$rootScope","$location","$translate","tmhDynamicLocale","usersession",function(e,t,n,o,a,i){var r="MakeMyBooking";e.pageTitle=r,e.$on("$routeChangeSuccess",function(t,n){e.currentRoute=n,e.pageTitle=n.title||r}),e.user=i.current,e.routeIs=function(e){return n.path()===e},e.logout=function(){i.logout(),n.url("/")},e.$on("event:loggedin",function(t,n){e.user=n}),e.$on("event:loggedout",function(t,n){e.user=n}),e.changeLanguage=function(e){o.use(e),a.set(e),t.langKey=e},e.langKey=o.proposedLanguage(),t.langKey=e.langKey}]);